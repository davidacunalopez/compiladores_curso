import os
import scanner as Scanner
from parser import parser

# Archivos predefinidos para pruebas
ARCHIVOS_PREDEFINIDOS = {
    "1": "Entregable 3/Parser/Archivos de prueba/prueba.ne",
    "2": "Entregable 3/Parser/Archivos de prueba/test-mcr-01-Estructura del programa.ne"
}

def limpiar_pantalla():
    os.system('cls' if os.name == 'nt' else 'clear')

def mostrar_menu():
    print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ")
    print("โ        MENร PRINCIPAL             โ")
    print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ")
    print("โ 1. Probar Scanner                 โ")
    print("โ 2. Probar Parser                  โ")
    print("โ 3. Salir                          โ")
    print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ")

def mostrar_menu_archivos():
    print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ")
    print("โ     SELECCIรN DE ARCHIVO          โ")
    print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ")
    print("โ 1. Usar archivo predefinido       โ")
    print("โ 2. Ingresar ruta personalizada    โ")
    print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ")

def mostrar_archivos_predefinidos():
    print("\nโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ")
    print("โ     ARCHIVOS PREDEFINIDOS         โ")
    print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ")
    for key, path in ARCHIVOS_PREDEFINIDOS.items():
        print(f"โ {key}. {path:<25} โ")
    print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ")

def obtener_ruta_archivo():
    mostrar_menu_archivos()
    opcion = input("\nSeleccione una opciรณn (1-2): ")
    
    if opcion == "1":
        mostrar_archivos_predefinidos()
        num_archivo = input("\nSeleccione un archivo (1-3): ")
        if num_archivo in ARCHIVOS_PREDEFINIDOS:
            return ARCHIVOS_PREDEFINIDOS[num_archivo]
        else:
            print("\nโ Opciรณn no vรกlida")
            return None
    elif opcion == "2":
        ruta = input("\n๐ Ingrese la ruta del archivo: ")
        return ruta
    else:
        print("\nโ Opciรณn no vรกlida")
        return None

def probar_scanner():
    limpiar_pantalla()
    print("๐ MODO SCANNER")
    print("=" * 40)
    
    ruta_archivo = obtener_ruta_archivo()
    if not ruta_archivo:
        input("\nPresione Enter para continuar...")
        return
    
    try:
        scanner = Scanner.AnalizadorLexico()
        scanner.InicializarScanner(ruta_archivo)
        
        print("\n๐ Resultados del anรกlisis lรฉxico:")
        print("-" * 40)
        
        while True:
            token = scanner.DemeToken()
            if token == None:  # EOF
                break
            print(f"Token: {token.lexema:<20} Cรณdigo: {token.codigo}")
            
    except Exception as e:
        print(f"โ Error al analizar el archivo: {str(e)}")
    
    input("\nPresione Enter para continuar...")

def probar_parser():
    limpiar_pantalla()
    print("๐ MODO PARSER")
    print("=" * 40)
    
    ruta_archivo = obtener_ruta_archivo()
    print(ruta_archivo)
    if not ruta_archivo:
        input("\nPresione Enter para continuar...")
        return
    
    try:
        scanner = Scanner.AnalizadorLexico()
        resultado = parser(scanner, ruta_archivo)
        
        if resultado:
            print("\nโ Anรกlisis sintรกctico completado exitosamente")
        else:
            print("\nโ El anรกlisis sintรกctico encontrรณ errores")
            
    except Exception as e:
        print(f"โ Error al analizar el archivo: {str(e)}")
    
    input("\nPresione Enter para continuar...")

def main():
    while True:
        limpiar_pantalla()
        mostrar_menu()
        
        opcion = input("\nSeleccione una opciรณn (1-3): ")
        
        if opcion == "1":
            probar_scanner()
        elif opcion == "2":
            probar_parser()
        elif opcion == "3":
            print("\n๐ ยกGracias por usar el programa!")
            break
        else:
            print("\nโ Opciรณn no vรกlida. Por favor, seleccione 1, 2 o 3.")
            input("Presione Enter para continuar...")

if __name__ == "__main__":
    main()
